#!/usr/bin/env sh
set -e

out=""
bullet="★"
none="♥"
notifs=$(makoctl list | grep "Notification " | wc -l)
mpdStatus=$(rmpc status)
mpdState=$(echo $mpdStatus | jq -r .state)

if [ $notifs = "0" ]; then
  :
elif [ $notifs = "1" ]; then
  out="$bullet 1 new notification\n"
else
  out="$bullet $notifs new notifications\n"
fi

if [ $mpdState = "Stop" ]; then
  :
elif [ $mpdState = "Play" ] || [ $mpdState = "Pause" ]; then
  mpdSong=$(rmpc song | jq -r '.metadata | "\(.artist) — \(.title)"')
  out+="♫ $mpdSong\n"
else
  :
fi

if [ "$out" = "" ]; then
  printf $none
else
  printf "$out"
fi
